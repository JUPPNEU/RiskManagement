#!/usr/bin/env node
const fs = require('fs-extra');
const commandLineArgs = require('command-line-args');
const toolUtils = require('../tool-utils');
const {MetadataMigrate} = require("./migrate-script");

const optionDefinitions = [
	{ name: 'project', type: String, multiple: false },
	{ name: 'preview', type: Boolean, multiple: false, defaultValue: false },
    { name: 'log-file', type: String, multiple: false }
];

let options = commandLineArgs(optionDefinitions);
let logFilePath = options['log-file'];
if (!options['project']) {
    options['project'] = process.cwd();
}
let isPreview = options["preview"];

function checkScriptFiles() {
    let appBasePath = options["project"];
    const args = {
        srcdir: appBasePath,
        log: logFilePath
    };
    if (isPreview) {
        const tempFolder = toolUtils.getTempDirectory("mdk_migration");
        if (fs.existsSync(tempFolder)) {
            fs.emptyDirSync(tempFolder);
        } else {
            fs.mkdirSync(tempFolder);
        }
        args.outdir = tempFolder
    }
    const c = new MetadataMigrate(args);
    return c.run();
}

module.exports = { checkScriptFiles };